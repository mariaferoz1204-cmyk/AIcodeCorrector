<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Code Debugger</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/homestyle.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="header-left">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo-image">
      <h1 class="site-title">AI Code Debugger</h1>
    </div>
    <nav class="nav">
      <ul class="nav-left">
        <li><a href="{{ url_for('home') }}" class="nav-link active">Home</a></li>
        <li><a href="{{ url_for('view_history') }}" class="nav-link">History</a></li>
      </ul>
      <div class="nav-right">
        <span>Hi, <strong>{{ user }}</strong></span>
        <a href="{{ url_for('logout') }}" class="logout-btn">LOGOUT</a>
      </div>
    </nav>
  </header>

  <section class="hero">
    <div class="hero-overlay">
      <h2>Welcome back, <span class="highlight">{{ user }}</span></h2>
      <div class="debug-container">
          <select id="languageSelect" class="lang-dropdown">
              <option value="Python">Python</option>
              <option value="Java">Java</option>
              <option value="C++">C++</option>
          </select>
          <textarea id="codeInput" placeholder="Paste your code here..."></textarea>
          <button class="start-debugging" onclick="runAnalysis()">Start Debugging</button>
          <div id="resultDisplay" class="result-box" style="display: none;">
              <h3 id="resultStatus"></h3>
              <p id="resultMessage"></p>
          </div>
      </div>
    </div>
  </section>

  <script>
    async function runAnalysis() {
        const code = document.getElementById('codeInput').value;
        const language = document.getElementById('languageSelect').value;
        const resDiv = document.getElementById('resultDisplay');
        
        const response = await fetch('/analyze', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ code: code, language: language })
        });
        const result = await response.json();
        resDiv.style.display = 'block';
        document.getElementById('resultStatus').innerText = result.status.toUpperCase();
        document.getElementById('resultMessage').innerText = result.message;
        resDiv.className = result.status === 'success' ? 'result-box success' : 'result-box error';
    }
  </script>
</body>
</html>