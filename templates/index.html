<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Code Debugger</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/homestyle.css') }}">
</head>
<body>

  <header class="header">
    <div class="header-left">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo-image">
      <h1 class="site-title">AI Code Debugger</h1>
    </div>
    
    <nav class="nav">
      <ul class="nav-left">
        <ul class="nav-list">
    <li><a href="{{ url_for('home') }}" class="nav-item">Home</a></li>
    <li><a href="{{ url_for('view_history') }}" class="nav-item">My History</a></li>
    <li><a href="#" class="nav-item active">About</a></li>
  </ul>
      </ul>
      <div class="nav-right">
        <span class="user-greeting">Hi, {{ user }}</span>
        <a href="{{ url_for('logout') }}" class="signup" style="text-decoration: none; text-align: center;">LOGOUT</a>
      </div>
    </nav>
  </header>

  <section class="hero">
  <div class="hero-overlay">
    <h2>Welcome back, <span class="highlight">{{ user }}</span></h2>
    <p>Ready to fix some code? Select a language and paste your snippet.</p>
    
    <div class="debug-container" style="margin-top: 20px;">
        <select id="languageSelect" style="padding: 10px; border-radius: 5px; margin-bottom: 10px; width: 80%;">
            <option value="Python">Python</option>
            <option value="Java">Java</option>
            <option value="C++">C++</option>
        </select>
        <br>
        <textarea id="codeInput" placeholder="Paste code here..." style="width: 80%; height: 150px; border-radius: 10px; padding: 10px;"></textarea>
        <br>
        <button class="start-debugging" onclick="runAnalysis()">Start Debugging</button>
        
        <div id="resultBox" style="display: none; margin-top: 20px; padding: 15px; border-radius: 10px; width: 80%; margin-left: auto; margin-right: auto;">
            <p id="resultText" style="font-weight: 600;"></p>
        </div>
    </div>
  </div>
</section>

<script>
  async function runAnalysis() {
      const code = document.getElementById('codeInput').value;
      const lang = document.getElementById('languageSelect').value; // Get selected language
      const resultBox = document.getElementById('resultBox');
      const resultText = document.getElementById('resultText');

      const response = await fetch('/analyze', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ code: code, language: lang })
      });
      
      const result = await response.json();

      // Show the result on the page instead of an alert
      resultBox.style.display = 'block';
      resultText.innerText = result.status.toUpperCase() + ": " + result.message;

      // Color coding: Green for success, Red for error
      if (result.status === "success") {
          resultBox.style.backgroundColor = "#d4edda";
          resultBox.style.color = "#155724";
      } else {
          resultBox.style.backgroundColor = "#f8d7da";
          resultBox.style.color = "#721c24";
      }
  }
</script>